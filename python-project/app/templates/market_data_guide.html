{% extends "layout.html" %}
{% block title %}Market Data API — {{ app_name }}{% endblock %}
{% block page_title %}Market Data API{% endblock %}
{% block content %}

<div class="max-w-5xl mx-auto space-y-6">

    <!-- Introduction -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="book-open" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Overview</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                The {{ app_name }} Market Data API returns OHLCV candlestick bars for any trading instrument on your synced accounts.
                Specify a symbol, timeframe, and bar count to get historical price data.
                All endpoints accept authentication via <span class="font-mono text-brand-400">X-API-Key</span> header or
                <span class="font-mono text-brand-400">api_key</span> query parameter.
            </p>
            <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4">
                <i data-lucide="info" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    Find your API key on the <a href="/settings" class="text-brand-400 hover:text-brand-300 underline">Settings</a> page.
                    Your Arrissa Account IDs are shown on the <a href="/dashboard" class="text-brand-400 hover:text-brand-300 underline">Dashboard</a> and <a href="/brokers" class="text-brand-400 hover:text-brand-300 underline">Brokers</a> pages.
                </p>
            </div>
        </div>
    </div>

    <!-- Authentication -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="shield" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Authentication</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                Every request must include your API key. You can pass it in two ways:
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-2">Header</p>
                    <code class="text-sm font-mono text-brand-400">X-API-Key: your_api_key</code>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-2">Query Parameter</p>
                    <code class="text-sm font-mono text-brand-400">?api_key=your_api_key</code>
                </div>
            </div>
        </div>
    </div>

    <!-- GET /api/market-data -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center justify-between">
            <div class="flex flex-row items-center gap-3">
                <span class="text-xs font-bold uppercase tracking-wider bg-green-900/40 text-green-400 border border-green-800 px-2.5 py-1 rounded-lg">GET</span>
                <h3 class="text-base font-semibold text-white font-mono">/api/market-data</h3>
            </div>
        </div>
        <div class="p-6 space-y-6">

            <p class="text-sm text-surface-300 leading-relaxed">
                Returns OHLCV candlestick bars (open, high, low, close, volume) for a given symbol and timeframe.
            </p>

            <!-- Parameters Table -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Parameters</p>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                                <th class="text-left py-3 px-4 font-semibold">Name</th>
                                <th class="text-left py-3 px-4 font-semibold">In</th>
                                <th class="text-left py-3 px-4 font-semibold">Required</th>
                                <th class="text-left py-3 px-4 font-semibold">Description</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-surface-800">
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">api_key</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Header / Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-red-900/40 text-red-400 font-semibold">Required</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Your API key (header: <span class="font-mono text-surface-200">X-API-Key</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">arrissa_account_id</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Header / Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-red-900/40 text-red-400 font-semibold">Required</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Your 6-character account ID (header: <span class="font-mono text-surface-200">X-Arrissa-Account-Id</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">symbol</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-red-900/40 text-red-400 font-semibold">Required</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Trading instrument symbol (e.g. <span class="font-mono text-surface-200">EURUSD</span>, <span class="font-mono text-surface-200">BTCUSD</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">timeframe</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-red-900/40 text-red-400 font-semibold">Required</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Candlestick timeframe (see list below)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">count</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Number of bars to return (default: <span class="font-mono text-surface-200">100</span>, max: <span class="font-mono text-surface-200">5000</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">period</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Time period instead of count: <span class="font-mono text-surface-200">last-X-unit</span> or <span class="font-mono text-surface-200">future</span> (requires <span class="font-mono text-surface-200">future_limit</span> + <span class="font-mono text-surface-200">pretend_date</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">future_limit</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Used with <span class="font-mono text-surface-200">period=future</span>. Format: <span class="font-mono text-surface-200">next-X-unit</span> (e.g. <span class="font-mono text-surface-200">next-2-days</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">pretend_date</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Simulate a different "now" date in UTC (<span class="font-mono text-surface-200">YYYY-MM-DD</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">pretend_time</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Time component for pretend date in UTC (<span class="font-mono text-surface-200">HH:MM</span>, defaults to <span class="font-mono text-surface-200">00:00</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">ma</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Moving average period(s), comma-separated (<span class="font-mono text-surface-200">ma=20</span> or <span class="font-mono text-surface-200">ma=20,50,200</span>). Adds <span class="font-mono text-surface-200">ma_X</span> fields to each bar. Extra prior data is fetched automatically for calculation; <span class="font-mono text-surface-200">null</span> where insufficient data.</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">quarters_s_n_r</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Set to <span class="font-mono text-surface-200">true</span> to include <span class="font-mono text-surface-200">supports</span> and <span class="font-mono text-surface-200">resistances</span> arrays in the response. Calculates 7 quarter-based support &amp; resistance levels from the dataset's high/low range: highest, lowest, 3 quarter divisions (25%, 50%, 75%), and extensions above/below.</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">volume</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Set to <span class="font-mono text-surface-200">true</span> to include volume data in each bar. Defaults to <span class="font-mono text-surface-200">false</span> (no volume).</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">order_blocks</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Set to <span class="font-mono text-surface-200">true</span> (requires <span class="font-mono text-surface-200">quarters_s_n_r=true</span>) to include an <span class="font-mono text-surface-200">order_blocks</span> array. Finds the last bearish candle before the Low / 25% touch &amp; the last bullish candle before the 75% / High touch &mdash; key institutional entry zones.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4 mt-3">
                    <i data-lucide="info" class="w-4 h-4 text-blue-400 flex-shrink-0 mt-0.5"></i>
                    <p class="text-xs text-surface-400"><span class="font-mono text-surface-200">count</span> and <span class="font-mono text-surface-200">period</span> are mutually exclusive — use one or the other. If neither is provided, <span class="font-mono text-surface-200">count</span> defaults to 100. Use <span class="font-mono text-surface-200">period=future</span> with <span class="font-mono text-surface-200">future_limit</span> + <span class="font-mono text-surface-200">pretend_date</span> to get bars ahead of a pretend date (can't get real future market data).</p>
                </div>
            </div>

            <!-- Period Format -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Period Format</p>
                <p class="text-sm text-surface-300 mb-3">Use <span class="font-mono text-brand-400">last-X-unit</span> for past data or <span class="font-mono text-brand-400">future</span> with <span class="font-mono text-brand-400">future_limit=next-X-unit</span> for forward data:</p>
                <div class="grid grid-cols-3 sm:grid-cols-6 gap-2">
                    {% for unit in ["minutes", "hours", "days", "weeks", "months", "years"] %}
                    <div class="text-center">
                        <span class="block text-xs font-mono px-2.5 py-1.5 rounded-lg bg-surface-800 border border-surface-700 text-surface-200">{{ unit }}</span>
                    </div>
                    {% endfor %}
                </div>
                <div class="mt-3 space-y-2">
                    <p class="text-xs text-surface-400 font-mono">last-30-minutes &nbsp; last-4-hours &nbsp; last-7-days &nbsp; last-2-weeks &nbsp; last-3-months &nbsp; last-1-years</p>
                    <p class="text-xs text-surface-400 font-mono">period=future&future_limit=next-2-days &nbsp; period=future&future_limit=next-4-hours</p>
                </div>
            </div>

            <!-- Timeframes -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Available Timeframes</p>
                <div class="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-9 gap-2">
                    {% for tf in ["M1", "M5", "M15", "M30", "H1", "H4", "D1", "W1", "MN1"] %}
                    <div class="text-center">
                        <span class="block text-xs font-mono px-2.5 py-1.5 rounded-lg bg-surface-800 border border-surface-700 text-surface-200">{{ tf }}</span>
                        <span class="block text-xs text-surface-400 mt-1">
                            {% if tf == "M1" %}1 min{% elif tf == "M5" %}5 min{% elif tf == "M15" %}15 min{% elif tf == "M30" %}30 min{% elif tf == "H1" %}1 hour{% elif tf == "H4" %}4 hour{% elif tf == "D1" %}Daily{% elif tf == "W1" %}Weekly{% elif tf == "MN1" %}Monthly{% endif %}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Response -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Response</p>
                <pre class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto"><code class="language-json">{
  "arrissa_data_HEROFX_live": {
    "arrissa_account_id": "A3F2B1",
    "symbol": "EURUSD",
    "timeframe": "H1",
    "count": 3,
    "from": "Thu 2025-02-13 22:00",
    "to": "Fri 2025-02-14 00:00",
    "bars": [
      {
        "time": "Thu 2025-02-13 22:00",
        "open": 1.04521,
        "high": 1.04589,
        "low": 1.04498,
        "close": 1.04567,
        "volume": 4521.3
      },
      {
        "time": "Thu 2025-02-13 23:00",
        "open": 1.04567,
        "high": 1.04612,
        "low": 1.04530,
        "close": 1.04598,
        "volume": 3892.1
      },
      {
        "time": "Fri 2025-02-14 00:00",
        "open": 1.04598,
        "high": 1.04645,
        "low": 1.04561,
        "close": 1.04623,
        "volume": 5103.7
      }
    ]
  }
}</code></pre>
                <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4 mt-3">
                    <i data-lucide="info" class="w-4 h-4 text-blue-400 flex-shrink-0 mt-0.5"></i>
                    <p class="text-xs text-surface-400">The root key <span class="font-mono text-brand-400">arrissa_data_{server}_{environment}</span> wraps all responses, where <span class="font-mono text-surface-200">{server}</span> is the broker server and <span class="font-mono text-surface-200">{environment}</span> is <span class="font-mono text-surface-200">live</span> or <span class="font-mono text-surface-200">demo</span>.</p>
                </div>
            </div>

            <!-- Bar Fields -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Bar Fields</p>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                                <th class="text-left py-3 px-4 font-semibold">Field</th>
                                <th class="text-left py-3 px-4 font-semibold">Type</th>
                                <th class="text-left py-3 px-4 font-semibold">Description</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-surface-800">
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">from</td>
                                <td class="py-3 px-4 text-sm text-surface-300">string</td>
                                <td class="py-3 px-4 text-sm text-surface-300">UTC timestamp of the first bar (<span class="font-mono text-surface-200">Ddd YYYY-MM-DD HH:MM</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">to</td>
                                <td class="py-3 px-4 text-sm text-surface-300">string</td>
                                <td class="py-3 px-4 text-sm text-surface-300">UTC timestamp of the last bar (<span class="font-mono text-surface-200">Ddd YYYY-MM-DD HH:MM</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">time</td>
                                <td class="py-3 px-4 text-sm text-surface-300">string</td>
                                <td class="py-3 px-4 text-sm text-surface-300">UTC timestamp of the bar (<span class="font-mono text-surface-200">Ddd YYYY-MM-DD HH:MM</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">open</td>
                                <td class="py-3 px-4 text-sm text-surface-300">number</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Opening price of the bar</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">high</td>
                                <td class="py-3 px-4 text-sm text-surface-300">number</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Highest price during the bar</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">low</td>
                                <td class="py-3 px-4 text-sm text-surface-300">number</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Lowest price during the bar</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">close</td>
                                <td class="py-3 px-4 text-sm text-surface-300">number</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Closing price of the bar</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">volume</td>
                                <td class="py-3 px-4 text-sm text-surface-300">number</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Trading volume during the bar</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Examples -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Examples</p>
                <div class="space-y-3">

                    <!-- Example 1: EURUSD H1 -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD hourly, last 100 bars</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;count=<span class="text-amber-400">100</span>
                        </a>
                    </div>

                    <!-- Example 2: BTCUSD D1 -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">BTCUSD daily, last 30 bars</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=BTCUSD&timeframe=D1&count=30"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">BTCUSD</span>&amp;timeframe=<span class="text-amber-400">D1</span>&amp;count=<span class="text-amber-400">30</span>
                        </a>
                    </div>

                    <!-- Example 3: Moving Averages -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD H1 with 20 &amp; 50 period moving averages</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&ma=20,50"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;count=<span class="text-amber-400">100</span>&amp;ma=<span class="text-amber-400">20,50</span>
                        </a>
                    </div>

                    <!-- Example 4: 5-minute bars -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">GBPUSD 5-minute, last 500 bars</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=GBPUSD&timeframe=M5&count=500"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">GBPUSD</span>&amp;timeframe=<span class="text-amber-400">M5</span>&amp;count=<span class="text-amber-400">500</span>
                        </a>
                    </div>

                    <!-- Example 4: Period — last 7 days -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD hourly, last 7 days</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&period=last-7-days"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;period=<span class="text-amber-400">last-7-days</span>
                        </a>
                    </div>

                    <!-- Example 5: Period — last 30 minutes -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">BTCUSD 1-minute, last 30 minutes</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=BTCUSD&timeframe=M1&period=last-30-minutes"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">BTCUSD</span>&amp;timeframe=<span class="text-amber-400">M1</span>&amp;period=<span class="text-amber-400">last-30-minutes</span>
                        </a>
                    </div>

                    <!-- Example 6: Pretend date/time with period -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD M1, last 5 min as if now is Oct 8, 2025 08:05</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=M1&period=last-5-minutes&pretend_date=2025-10-08&pretend_time=08:05"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">M1</span>&amp;period=<span class="text-amber-400">last-5-minutes</span>&amp;pretend_date=<span class="text-amber-400">2025-10-08</span>&amp;pretend_time=<span class="text-amber-400">08:05</span>
                        </a>
                    </div>

                    <!-- Example 7: Pretend date with count -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD H1, 50 bars back from Jan 15, 2026 12:00</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=50&pretend_date=2026-01-15&pretend_time=12:00"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;count=<span class="text-amber-400">50</span>&amp;pretend_date=<span class="text-amber-400">2026-01-15</span>&amp;pretend_time=<span class="text-amber-400">12:00</span>
                        </a>
                    </div>

                    <!-- Example 8: Future — next 2 days from pretend date -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD H1, next 2 days from Jan 10 2026 (future)</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&period=future&future_limit=next-2-days&pretend_date=2026-01-10&pretend_time=08:00"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;period=<span class="text-amber-400">future</span>&amp;future_limit=<span class="text-amber-400">next-2-days</span>&amp;pretend_date=<span class="text-amber-400">2026-01-10</span>&amp;pretend_time=<span class="text-amber-400">08:00</span>
                        </a>
                    </div>

                    <!-- Example 9: Quarters Support & Resistance -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD H1 with Quarters Support &amp; Resistance levels</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&quarters_s_n_r=true"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;count=<span class="text-amber-400">100</span>&amp;quarters_s_n_r=<span class="text-amber-400">true</span>
                        </a>
                    </div>

                    <!-- Example 10: MA + Quarters S&R combined -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD H1 with MA(20,50) + Quarters S&amp;R</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&ma=20,50&quarters_s_n_r=true"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;count=<span class="text-amber-400">100</span>&amp;ma=<span class="text-amber-400">20,50</span>&amp;quarters_s_n_r=<span class="text-amber-400">true</span>
                        </a>
                    </div>

                    <!-- Example 11: With volume -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD H1 with volume data included</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=50&volume=true"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;count=<span class="text-amber-400">50</span>&amp;volume=<span class="text-amber-400">true</span>
                        </a>
                    </div>

                    <!-- Example 12: Order Blocks -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">EURUSD H1 with Quarters S&amp;R + Order Blocks</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/market-data?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&quarters_s_n_r=true&order_blocks=true"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/market-data?symbol=<span class="text-amber-400">EURUSD</span>&amp;timeframe=<span class="text-amber-400">H1</span>&amp;count=<span class="text-amber-400">100</span>&amp;quarters_s_n_r=<span class="text-amber-400">true</span>&amp;order_blocks=<span class="text-amber-400">true</span>
                        </a>
                    </div>

                    <!-- Example 13: cURL -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">cURL with headers</p>
                            <button onclick="copyCurl()" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="copy" class="w-3.5 h-3.5"></i>
                                <span>Copy</span>
                            </button>
                        </div>
                        <pre id="curlExample" class="text-sm overflow-x-auto"><code class="language-bash">curl -H "X-API-Key: {{ api_key }}" \
     -H "X-Arrissa-Account-Id: {{ example_account_id or 'ACCT_ID' }}" \
     "{{ site_url }}/api/market-data?symbol=EURUSD&timeframe=H1&period=last-7-days"</code></pre>
                    </div>

                </div>
            </div>

            <!-- Error Responses -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Error Responses</p>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                                <th class="text-left py-3 px-4 font-semibold">Code</th>
                                <th class="text-left py-3 px-4 font-semibold">Reason</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-surface-800">
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-red-900/40 text-red-400 font-semibold">401</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Missing or invalid API key</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-red-900/40 text-red-400 font-semibold">400</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Missing required parameter (arrissa_account_id, symbol, or timeframe) or invalid timeframe/count</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-amber-900/40 text-amber-400 font-semibold">403</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">API key does not have access to this account</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-amber-900/40 text-amber-400 font-semibold">404</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Account not found or symbol not available</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-amber-900/40 text-amber-400 font-semibold">502</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Failed to reach TradeLocker — token may be expired</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

</div>

<script>
function tryExample(btn) {
    const link = btn.closest('.bg-surface-800').querySelector('a');
    if (link) window.open(link.href, '_blank');
}
function copyCurl() {
    const text = document.getElementById('curlExample').textContent;
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.querySelector('[onclick="copyCurl()"] span');
        const orig = btn.textContent;
        btn.textContent = 'Copied';
        setTimeout(() => btn.textContent = orig, 2000);
    });
}
</script>

{% endblock %}
