{% extends "layout.html" %}
{% block title %}Instruments API — {{ app_name }}{% endblock %}
{% block page_title %}Instruments API{% endblock %}
{% block content %}

<div class="max-w-5xl mx-auto space-y-6">

    <!-- Introduction -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="book-open" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Overview</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                The {{ app_name }} API lets you query available trading instruments for any of your synced accounts.
                All endpoints accept authentication via <span class="font-mono text-brand-400">X-API-Key</span> header or
                <span class="font-mono text-brand-400">api_key</span> query parameter.
            </p>
            <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4">
                <i data-lucide="info" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    Find your API key on the <a href="/settings" class="text-brand-400 hover:text-brand-300 underline">Settings</a> page.
                    Your Arrissa Account IDs are shown on the <a href="/dashboard" class="text-brand-400 hover:text-brand-300 underline">Dashboard</a> and <a href="/brokers" class="text-brand-400 hover:text-brand-300 underline">Brokers</a> pages.
                </p>
            </div>
        </div>
    </div>

    <!-- Authentication -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="shield" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Authentication</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                Every request must include your API key. You can pass it in two ways:
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-2">Header</p>
                    <code class="text-sm font-mono text-brand-400">X-API-Key: your_api_key</code>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-2">Query Parameter</p>
                    <code class="text-sm font-mono text-brand-400">?api_key=your_api_key</code>
                </div>
            </div>
        </div>
    </div>

    <!-- GET /api/instruments -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center justify-between">
            <div class="flex flex-row items-center gap-3">
                <span class="text-xs font-bold uppercase tracking-wider bg-green-900/40 text-green-400 border border-green-800 px-2.5 py-1 rounded-lg">GET</span>
                <h3 class="text-base font-semibold text-white font-mono">/api/instruments</h3>
            </div>
        </div>
        <div class="p-6 space-y-6">

            <p class="text-sm text-surface-300 leading-relaxed">
                Returns a list of all available trading instrument symbols for the specified account.
            </p>

            <!-- Parameters Table -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Parameters</p>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                                <th class="text-left py-3 px-4 font-semibold">Name</th>
                                <th class="text-left py-3 px-4 font-semibold">In</th>
                                <th class="text-left py-3 px-4 font-semibold">Required</th>
                                <th class="text-left py-3 px-4 font-semibold">Description</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-surface-800">
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">api_key</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Header / Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-red-900/40 text-red-400 font-semibold">Required</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Your API key (header: <span class="font-mono text-surface-200">X-API-Key</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">arrissa_account_id</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Header / Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-red-900/40 text-red-400 font-semibold">Required</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Your 6-character account ID (header: <span class="font-mono text-surface-200">X-Arrissa-Account-Id</span>)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">search</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Filter symbols containing this text (case-insensitive)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">type</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Query</td>
                                <td class="py-3 px-4"><span class="text-xs px-2 py-0.5 rounded-full bg-surface-700 text-surface-300 font-semibold">Optional</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Filter by instrument type</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Types -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Instrument Types</p>
                <div class="flex flex-wrap gap-2">
                    {% for t in ["CRYPTO", "EQUITY", "EQUITY_CFD", "ETF", "FOREX", "FUTURES", "FUTURES_CFD", "INDICES", "OPTIONS", "SPREADBET"] %}
                    <span class="text-xs font-mono px-2.5 py-1.5 rounded-lg bg-surface-800 border border-surface-700 text-surface-200">{{ t }}</span>
                    {% endfor %}
                </div>
            </div>

            <!-- Response -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Response</p>
                <pre class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto"><code class="language-json">{
  "arrissa_data_HEROFX_live": {
    "arrissa_account_id": "A3F2B1",
    "total": 142,
    "types": ["CRYPTO", "FOREX", "INDICES"],
    "instruments": [
      { "symbol": "EURUSD", "type": "FOREX" },
      { "symbol": "BTCUSD", "type": "CRYPTO" }
    ]
  }
}</code></pre>
                <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4 mt-3">
                    <i data-lucide="info" class="w-4 h-4 text-blue-400 flex-shrink-0 mt-0.5"></i>
                    <p class="text-xs text-surface-400">The root key <span class="font-mono text-brand-400">arrissa_data_{server}_{environment}</span> wraps all responses, where <span class="font-mono text-surface-200">{server}</span> is the broker server and <span class="font-mono text-surface-200">{environment}</span> is <span class="font-mono text-surface-200">live</span> or <span class="font-mono text-surface-200">demo</span>.</p>
                </div>
            </div>

            <!-- Examples -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Examples</p>
                <div class="space-y-3">

                    <!-- Example 1: All instruments -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">All instruments</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/instruments?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/instruments?api_key=<span class="text-brand-400">YOUR_KEY</span>&amp;arrissa_account_id=<span class="text-brand-400">{{ example_account_id or 'ACCT_ID' }}</span>
                        </a>
                    </div>

                    <!-- Example 2: Search -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">Search for EUR pairs</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/instruments?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&search=EUR"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/instruments?api_key=<span class="text-brand-400">YOUR_KEY</span>&amp;arrissa_account_id=<span class="text-brand-400">{{ example_account_id or 'ACCT_ID' }}</span>&amp;search=<span class="text-amber-400">EUR</span>
                        </a>
                    </div>

                    <!-- Example 3: Filter by type -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">Only FOREX instruments</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/instruments?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&type=FOREX"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/instruments?api_key=<span class="text-brand-400">YOUR_KEY</span>&amp;arrissa_account_id=<span class="text-brand-400">{{ example_account_id or 'ACCT_ID' }}</span>&amp;type=<span class="text-amber-400">FOREX</span>
                        </a>
                    </div>

                    <!-- Example 4: Search + type -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">Search BTC in CRYPTO</p>
                            <button onclick="tryExample(this)" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </button>
                        </div>
                        <a href="/api/instruments?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&search=BTC&type=CRYPTO"
                           target="_blank"
                           class="block font-mono text-sm text-surface-200 hover:text-brand-400 transition break-all">
                            GET /api/instruments?api_key=<span class="text-brand-400">YOUR_KEY</span>&amp;arrissa_account_id=<span class="text-brand-400">{{ example_account_id or 'ACCT_ID' }}</span>&amp;search=<span class="text-amber-400">BTC</span>&amp;type=<span class="text-amber-400">CRYPTO</span>
                        </a>
                    </div>

                    <!-- Example 5: cURL -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                        <div class="flex flex-row items-center justify-between mb-2">
                            <p class="text-xs font-semibold text-surface-400">cURL with headers</p>
                            <button onclick="copyCurl()" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="copy" class="w-3.5 h-3.5"></i>
                                <span>Copy</span>
                            </button>
                        </div>
                        <pre id="curlExample" class="text-sm overflow-x-auto"><code class="language-bash">curl -H "X-API-Key: {{ api_key }}" \
     -H "X-Arrissa-Account-Id: {{ example_account_id or 'ACCT_ID' }}" \
     {{ site_url }}/api/instruments</code></pre>
                    </div>

                </div>
            </div>

            <!-- Error Responses -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Error Responses</p>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                                <th class="text-left py-3 px-4 font-semibold">Code</th>
                                <th class="text-left py-3 px-4 font-semibold">Reason</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-surface-800">
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-red-900/40 text-red-400 font-semibold">401</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Missing or invalid API key</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-red-900/40 text-red-400 font-semibold">400</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Missing arrissa_account_id</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-amber-900/40 text-amber-400 font-semibold">403</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">API key does not have access to this account</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-amber-900/40 text-amber-400 font-semibold">404</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Account not found for the given arrissa_account_id</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4"><span class="text-xs font-mono px-2.5 py-1 rounded-lg bg-amber-900/40 text-amber-400 font-semibold">502</span></td>
                                <td class="py-3 px-4 text-sm text-surface-300">Failed to reach TradeLocker — token may be expired</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

</div>

<script>
function tryExample(btn) {
    const link = btn.closest('.bg-surface-800').querySelector('a');
    if (link) window.open(link.href, '_blank');
}
function copyCurl() {
    const text = document.getElementById('curlExample').textContent;
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.querySelector('[onclick="copyCurl()"] span');
        const orig = btn.textContent;
        btn.textContent = 'Copied';
        setTimeout(() => btn.textContent = orig, 2000);
    });
}
</script>

{% endblock %}
