{% extends "layout.html" %}
{% block title %}ASP Protocol — {{ app_name }}{% endblock %}
{% block page_title %}ASP Protocol{% endblock %}
{% block content %}

<div class="max-w-5xl mx-auto space-y-6">

    <!-- Introduction -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="search" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Overview</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                The {{ app_name }} <strong class="text-white">ASP</strong> (Agent Server Protocol) is a
                <strong class="text-white">separate protocol from MCP</strong> that enables intelligent tool discovery via HTTP.
                Instead of returning all tools, ASP uses <strong class="text-white">semantic embeddings</strong> to understand what an agent wants
                and returns only the <strong class="text-white">most relevant tools ranked by similarity</strong>.
            </p>
            <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4">
                <i data-lucide="info" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    Tool descriptions are converted to numerical vectors (embeddings) <strong class="text-white">once</strong>.
                    When an agent asks <em class="text-brand-400">"I want to buy bitcoin"</em>, ASP computes the query's embedding
                    and finds the closest matching tools using pure math (cosine similarity).
                    <strong class="text-white">No AI reasoning at query time — just fast math.</strong>
                </p>
            </div>
            <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4">
                <i data-lucide="zap" class="w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    <strong class="text-white">Why ASP?</strong> MCP returns all tools (works up to ~50). ASP scales to
                    <strong class="text-white">thousands of tools</strong> — agents only receive what's relevant,
                    reducing context bloat and improving accuracy.
                </p>
            </div>
            <div class="flex flex-row items-start gap-3 bg-red-900/20 border border-red-800/30 rounded-xl p-4">
                <i data-lucide="shield" class="w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    <strong class="text-white">Authentication Required.</strong> All ASP endpoints require a valid API key.
                    Send it as an <span class="font-mono text-brand-400">X-API-Key</span> header or
                    <span class="font-mono text-brand-400">?api_key=</span> query parameter.
                </p>
            </div>
        </div>
    </div>

    <!-- Authentication -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="shield" class="w-5 h-5 text-red-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Authentication</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                Every ASP request must include your API key. You can send it in <strong class="text-white">three ways</strong> (pick one):
            </p>
            <div class="space-y-3">
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <div class="flex flex-row items-center gap-2 mb-2">
                        <span class="text-xs font-bold px-2 py-0.5 rounded bg-brand-600/20 text-brand-400 border border-brand-600/30">RECOMMENDED</span>
                        <p class="text-sm font-semibold text-white">X-API-Key Header</p>
                    </div>
                    <pre class="bg-surface-900 border border-surface-700 rounded-lg p-3 text-sm font-mono overflow-x-auto text-surface-200">curl -X POST {{ site_url }}/asp/search \
  -H "X-API-Key: {{ api_key }}" \
  -H "Content-Type: application/json" \
  -d '{"query": "buy bitcoin"}'</pre>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-sm font-semibold text-white mb-2">Query Parameter</p>
                    <pre class="bg-surface-900 border border-surface-700 rounded-lg p-3 text-sm font-mono overflow-x-auto text-surface-200">curl "{{ site_url }}/asp/search?api_key={{ api_key }}&query=buy+bitcoin"</pre>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-sm font-semibold text-white mb-2">JSON Body</p>
                    <pre class="bg-surface-900 border border-surface-700 rounded-lg p-3 text-sm font-mono overflow-x-auto text-surface-200">curl -X POST {{ site_url }}/asp/search \
  -H "Content-Type: application/json" \
  -d '{"query": "buy bitcoin", "api_key": "{{ api_key }}"}'</pre>
                </div>
            </div>
            <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4">
                <i data-lucide="info" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    Your API key is: <code class="font-mono text-brand-400 bg-surface-800 px-2 py-0.5 rounded">{{ api_key }}</code>
                    — find it on the <a href="/settings" class="text-brand-400 underline">Settings</a> page.
                </p>
            </div>
        </div>
    </div>

    <!-- Status -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="activity" class="w-5 h-5 text-green-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Current Status</h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <div class="flex flex-row items-center gap-2 mb-2">
                        <i data-lucide="database" class="w-4 h-4 text-brand-400 flex-shrink-0"></i>
                        <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Embedding Provider</p>
                    </div>
                    <p class="text-sm text-surface-300">Local — <span class="font-mono text-brand-400">all-MiniLM-L6-v2</span></p>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <div class="flex flex-row items-center gap-2 mb-2">
                        <i data-lucide="layers" class="w-4 h-4 text-brand-400 flex-shrink-0"></i>
                        <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Vector Dimensions</p>
                    </div>
                    <p class="text-sm text-surface-300"><span class="font-mono text-brand-400">384</span> dimensions per tool</p>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <div class="flex flex-row items-center gap-2 mb-2">
                        <i data-lucide="check-circle-2" class="w-4 h-4 text-green-400 flex-shrink-0"></i>
                        <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Status</p>
                    </div>
                    <p class="text-sm text-surface-300">Check live: <span class="font-mono text-brand-400">GET /asp/status</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Core Endpoint: Search -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center justify-between">
            <div class="flex flex-row items-center gap-3">
                <i data-lucide="search" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
                <h3 class="text-base font-semibold text-white">Search for Tools</h3>
            </div>
            <span class="text-xs font-bold px-2.5 py-1 rounded-lg bg-blue-600/20 text-blue-400 border border-blue-600/30">POST</span>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                The core ASP endpoint. Send a natural language query and get the most relevant tools ranked by similarity score.
            </p>

            <div class="relative">
                <button onclick="copyConfig('search-example')" class="absolute top-3 right-3 flex flex-row items-center gap-1.5 text-xs text-surface-400 hover:text-brand-400 transition bg-surface-900/80 px-2.5 py-1.5 rounded-lg">
                    <i data-lucide="copy" class="w-3.5 h-3.5"></i><span>Copy</span>
                </button>
                <pre id="search-example" class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto"><code>curl -X POST {{ site_url }}/asp/search \
  -H "X-API-Key: {{ api_key }}" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "I want to buy bitcoin",
    "top_k": 5,
    "threshold": 0.15
  }'</code></pre>
            </div>

            <!-- Parameters -->
            <div>
                <div class="flex flex-row items-center gap-2 mb-3">
                    <i data-lucide="settings-2" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Parameters</p>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                                <th class="text-left py-3 px-4 font-semibold">Param</th>
                                <th class="text-left py-3 px-4 font-semibold">Type</th>
                                <th class="text-left py-3 px-4 font-semibold">Description</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-surface-800">
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">query</td>
                                <td class="py-3 px-4 text-sm text-surface-400">string</td>
                                <td class="py-3 px-4 text-sm text-surface-300"><strong class="text-white">Required</strong> — What the agent wants to do (natural language)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">top_k</td>
                                <td class="py-3 px-4 text-sm text-surface-400">int</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Number of results to return (default: 5, max: 20)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">threshold</td>
                                <td class="py-3 px-4 text-sm text-surface-400">float</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Minimum similarity score 0–1 (default: 0.15)</td>
                            </tr>
                            <tr>
                                <td class="py-3 px-4 font-mono text-sm text-brand-400">category</td>
                                <td class="py-3 px-4 text-sm text-surface-400">string</td>
                                <td class="py-3 px-4 text-sm text-surface-300">Filter by category before ranking (<span class="font-mono text-surface-200">account</span>, <span class="font-mono text-surface-200">trading</span>, <span class="font-mono text-surface-200">market_data</span>, <span class="font-mono text-surface-200">news</span>, <span class="font-mono text-surface-200">utility</span>, <span class="font-mono text-surface-200">system</span>)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Response -->
            <div>
                <div class="flex flex-row items-center gap-2 mb-3">
                    <i data-lucide="file-json" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Response</p>
                </div>
                <pre class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto"><code>{
  "query": "I want to buy bitcoin",
  "tools": [
    {
      "name": "trade",
      "description": "Execute trading actions — buy, sell, close...",
      "score": 0.48,
      "category": "trading",
      "parameters": {...},
      "endpoint": "/api/trade"
    }
  ],
  "count": 5,
  "provider": "local"
}</code></pre>
            </div>
        </div>
    </div>

    <!-- All API Endpoints -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center justify-between">
            <div class="flex flex-row items-center gap-3">
                <i data-lucide="wrench" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
                <h3 class="text-base font-semibold text-white">All ASP Endpoints</h3>
            </div>
            <span class="text-xs font-bold px-2.5 py-1 rounded-lg bg-brand-600/20 text-brand-400 border border-brand-600/30">8 Endpoints</span>
        </div>
        <div class="p-6 space-y-6">

            <!-- Discovery -->
            <div>
                <div class="flex flex-row items-center gap-2 mb-3">
                    <i data-lucide="compass" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Discovery</p>
                </div>
                <div class="space-y-2">
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-600/20 text-blue-400 border border-blue-600/30">POST</span>
                            <code class="text-sm font-mono text-brand-400">/asp/search</code>
                        </div>
                        <p class="text-sm text-surface-300">Search for tools by natural language query — returns ranked results</p>
                    </div>
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-green-600/20 text-green-400 border border-green-600/30">GET</span>
                            <code class="text-sm font-mono text-brand-400">/asp/tools</code>
                        </div>
                        <p class="text-sm text-surface-300">List all registered tools (optional: <span class="font-mono text-surface-200">?category=trading&search=buy</span>)</p>
                    </div>
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-green-600/20 text-green-400 border border-green-600/30">GET</span>
                            <code class="text-sm font-mono text-brand-400">/asp/status</code>
                        </div>
                        <p class="text-sm text-surface-300">System status — tool count, embedding info, health</p>
                    </div>
                </div>
            </div>

            <!-- Tool Management -->
            <div>
                <div class="flex flex-row items-center gap-2 mb-3">
                    <i data-lucide="package-plus" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Tool Management</p>
                </div>
                <div class="space-y-2">
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-600/20 text-blue-400 border border-blue-600/30">POST</span>
                            <code class="text-sm font-mono text-brand-400">/asp/tools</code>
                        </div>
                        <p class="text-sm text-surface-300">Register a new tool (auto-embeds immediately)</p>
                    </div>
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-600/20 text-blue-400 border border-blue-600/30">POST</span>
                            <code class="text-sm font-mono text-brand-400">/asp/tools/batch</code>
                        </div>
                        <p class="text-sm text-surface-300">Register multiple tools at once (batch embed)</p>
                    </div>
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-amber-600/20 text-amber-400 border border-amber-600/30">PUT</span>
                            <code class="text-sm font-mono text-brand-400">/asp/tools/&lt;name&gt;</code>
                        </div>
                        <p class="text-sm text-surface-300">Update a tool's definition (re-embeds automatically)</p>
                    </div>
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-red-600/20 text-red-400 border border-red-600/30">DELETE</span>
                            <code class="text-sm font-mono text-brand-400">/asp/tools/&lt;name&gt;</code>
                        </div>
                        <p class="text-sm text-surface-300">Remove a tool from the registry</p>
                    </div>
                    <div class="bg-surface-800 border border-surface-700 rounded-xl p-4 flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4">
                        <div class="flex items-center gap-2 flex-shrink-0">
                            <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-600/20 text-blue-400 border border-blue-600/30">POST</span>
                            <code class="text-sm font-mono text-brand-400">/asp/reindex</code>
                        </div>
                        <p class="text-sm text-surface-300">Recompute all embeddings (after changing provider or model)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Tool Example -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="plus-circle" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Register a Custom Tool</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                Add any tool from any API to the ASP registry. The embedding is computed automatically on registration — the tool becomes instantly searchable.
            </p>
            <div class="relative">
                <button onclick="copyConfig('register-example')" class="absolute top-3 right-3 flex flex-row items-center gap-1.5 text-xs text-surface-400 hover:text-brand-400 transition bg-surface-900/80 px-2.5 py-1.5 rounded-lg">
                    <i data-lucide="copy" class="w-3.5 h-3.5"></i><span>Copy</span>
                </button>
                <pre id="register-example" class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto"><code>curl -X POST {{ site_url }}/asp/tools \
  -H "X-API-Key: {{ api_key }}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "my_custom_tool",
    "description": "Sends an email notification with trade alerts",
    "category": "notifications",
    "tags": ["email", "alert", "notification"],
    "examples": [
      "send me an email about my trades",
      "notify me when price hits target",
      "email trade summary"
    ],
    "endpoint": "/api/my-tool",
    "method": "POST",
    "parameters": {"recipient": "str", "subject": "str"}
  }'</code></pre>
            </div>
            <div class="flex flex-row items-start gap-3 bg-green-900/20 border border-green-800/30 rounded-xl p-4">
                <i data-lucide="check-circle-2" class="w-5 h-5 text-green-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    New tools are <strong class="text-white">instantly searchable</strong> — no reindexing needed.
                    The embedding is computed during registration.
                </p>
            </div>
        </div>
    </div>

    <!-- Example Queries -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="message-circle" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Example Queries &amp; Results</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">ASP understands meaning, not just keywords. Here are examples showing which tool ranks #1 for each query:</p>

            <div class="space-y-3">
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <div class="flex flex-row items-center gap-2 mb-2">
                        <i data-lucide="trending-up" class="w-4 h-4 text-green-400 flex-shrink-0"></i>
                        <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Trading</p>
                    </div>
                    <div class="space-y-2">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                            <p class="text-sm text-surface-200 font-mono flex-1">"close all my losing trades now"</p>
                            <span class="text-xs font-mono text-brand-400 flex-shrink-0">→ trade <span class="text-green-400">(0.48)</span></span>
                        </div>
                        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                            <p class="text-sm text-surface-200 font-mono flex-1">"I want to buy bitcoin"</p>
                            <span class="text-xs font-mono text-brand-400 flex-shrink-0">→ trade <span class="text-green-400">(0.22)</span></span>
                        </div>
                        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                            <p class="text-sm text-surface-200 font-mono flex-1">"show my open positions"</p>
                            <span class="text-xs font-mono text-brand-400 flex-shrink-0">→ get_positions <span class="text-green-400">(0.40)</span></span>
                        </div>
                    </div>
                </div>

                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <div class="flex flex-row items-center gap-2 mb-2">
                        <i data-lucide="candlestick-chart" class="w-4 h-4 text-blue-400 flex-shrink-0"></i>
                        <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">Analysis</p>
                    </div>
                    <div class="space-y-2">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                            <p class="text-sm text-surface-200 font-mono flex-1">"what's my balance"</p>
                            <span class="text-xs font-mono text-brand-400 flex-shrink-0">→ get_account_details <span class="text-green-400">(0.27)</span></span>
                        </div>
                        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                            <p class="text-sm text-surface-200 font-mono flex-1">"show me a chart of EURUSD"</p>
                            <span class="text-xs font-mono text-brand-400 flex-shrink-0">→ get_chart_image <span class="text-green-400">(0.35)</span></span>
                        </div>
                    </div>
                </div>

                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <div class="flex flex-row items-center gap-2 mb-2">
                        <i data-lucide="newspaper" class="w-4 h-4 text-amber-400 flex-shrink-0"></i>
                        <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider">News</p>
                    </div>
                    <div class="space-y-2">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                            <p class="text-sm text-surface-200 font-mono flex-1">"any important economic news this week"</p>
                            <span class="text-xs font-mono text-brand-400 flex-shrink-0">→ get_economic_news <span class="text-green-400">(0.38)</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Architecture -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="network" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">How It Works</h3>
        </div>
        <div class="p-6 space-y-4">
            <div class="flex flex-col md:flex-row items-center justify-center gap-4 py-4">
                <div class="bg-surface-800 border border-surface-700 rounded-xl px-5 py-4 text-center">
                    <i data-lucide="bot" class="w-8 h-8 text-brand-400 mx-auto mb-2"></i>
                    <p class="text-sm font-semibold text-white">Agent</p>
                    <p class="text-xs text-surface-400">n8n / Custom / LLM</p>
                </div>
                <div class="flex flex-col items-center">
                    <i data-lucide="arrow-right" class="w-6 h-6 text-surface-500 hidden md:block"></i>
                    <i data-lucide="arrow-down" class="w-6 h-6 text-surface-500 md:hidden"></i>
                    <p class="text-xs text-surface-500 mt-1">HTTP POST</p>
                </div>
                <div class="bg-surface-800 border border-brand-600/30 rounded-xl px-5 py-4 text-center">
                    <i data-lucide="search" class="w-8 h-8 text-brand-400 mx-auto mb-2"></i>
                    <p class="text-sm font-semibold text-white">ASP Server</p>
                    <p class="text-xs text-surface-400">/asp/search</p>
                </div>
                <div class="flex flex-col items-center">
                    <i data-lucide="arrow-right" class="w-6 h-6 text-surface-500 hidden md:block"></i>
                    <i data-lucide="arrow-down" class="w-6 h-6 text-surface-500 md:hidden"></i>
                    <p class="text-xs text-surface-500 mt-1">cosine math</p>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl px-5 py-4 text-center">
                    <i data-lucide="database" class="w-8 h-8 text-green-400 mx-auto mb-2"></i>
                    <p class="text-sm font-semibold text-white">Vector DB</p>
                    <p class="text-xs text-surface-400">Tool Embeddings</p>
                </div>
                <div class="flex flex-col items-center">
                    <i data-lucide="arrow-right" class="w-6 h-6 text-surface-500 hidden md:block"></i>
                    <i data-lucide="arrow-down" class="w-6 h-6 text-surface-500 md:hidden"></i>
                    <p class="text-xs text-surface-500 mt-1">ranked tools</p>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl px-5 py-4 text-center">
                    <i data-lucide="check-circle-2" class="w-8 h-8 text-amber-400 mx-auto mb-2"></i>
                    <p class="text-sm font-semibold text-white">Agent Decides</p>
                    <p class="text-xs text-surface-400">Picks best tool</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ASP vs MCP Comparison -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="git-compare" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">ASP vs MCP</h3>
        </div>
        <div class="p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                            <th class="text-left py-3 px-4 font-semibold"></th>
                            <th class="text-left py-3 px-4 font-semibold">MCP</th>
                            <th class="text-left py-3 px-4 font-semibold">ASP</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-surface-800">
                        <tr>
                            <td class="py-3 px-4 text-sm font-semibold text-white">Transport</td>
                            <td class="py-3 px-4 text-sm text-surface-300">stdio (local process)</td>
                            <td class="py-3 px-4 text-sm text-surface-300">HTTP (network)</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 text-sm font-semibold text-white">Tool Discovery</td>
                            <td class="py-3 px-4 text-sm text-surface-300">Returns <strong class="text-surface-200">all</strong> tools</td>
                            <td class="py-3 px-4 text-sm text-surface-300">Returns <strong class="text-brand-400">relevant</strong> tools ranked by similarity</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 text-sm font-semibold text-white">Intelligence</td>
                            <td class="py-3 px-4 text-sm text-surface-300">Agent decides from full list</td>
                            <td class="py-3 px-4 text-sm text-surface-300">Embeddings pre-filter, agent decides</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 text-sm font-semibold text-white">Protocol</td>
                            <td class="py-3 px-4 text-sm text-surface-300">JSON-RPC</td>
                            <td class="py-3 px-4 text-sm text-surface-300">REST HTTP</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 text-sm font-semibold text-white">Scaling</td>
                            <td class="py-3 px-4 text-sm text-surface-300">~50 tools</td>
                            <td class="py-3 px-4 text-sm text-brand-400 font-semibold">Thousands of tools</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 text-sm font-semibold text-white">Server AI</td>
                            <td class="py-3 px-4 text-sm text-surface-300">None</td>
                            <td class="py-3 px-4 text-sm text-surface-300">None (just math)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Embedding Providers -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="cpu" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Embedding Providers</h3>
        </div>
        <div class="p-6 space-y-3">
            <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                <div class="flex flex-row items-center gap-2 mb-2">
                    <i data-lucide="hard-drive" class="w-4 h-4 text-green-400 flex-shrink-0"></i>
                    <p class="text-sm font-semibold text-white">Local (default)</p>
                    <span class="text-xs font-bold px-2 py-0.5 rounded bg-green-600/20 text-green-400 border border-green-600/30">FREE</span>
                </div>
                <p class="text-sm text-surface-300 mb-2">
                    Model: <span class="font-mono text-brand-400">all-MiniLM-L6-v2</span> — runs on CPU, 384 dimensions, no API key needed.
                </p>
                <p class="text-xs text-surface-400">No configuration needed — works out of the box.</p>
            </div>
            <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                <div class="flex flex-row items-center gap-2 mb-2">
                    <i data-lucide="cloud" class="w-4 h-4 text-blue-400 flex-shrink-0"></i>
                    <p class="text-sm font-semibold text-white">OpenAI</p>
                    <span class="text-xs font-bold px-2 py-0.5 rounded bg-blue-600/20 text-blue-400 border border-blue-600/30">API KEY</span>
                </div>
                <p class="text-sm text-surface-300 mb-2">
                    Model: <span class="font-mono text-brand-400">text-embedding-3-small</span> — higher quality, 1536 dimensions.
                </p>
                <pre class="bg-surface-900 border border-surface-700 rounded-lg p-3 text-sm font-mono overflow-x-auto text-surface-200">ASP_EMBEDDING_PROVIDER=openai
OPENAI_API_KEY=sk-...</pre>
            </div>
        </div>
    </div>

    <!-- Quick Start -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="rocket" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Quick Start</h3>
        </div>
        <div class="p-6 space-y-4">
            <div class="space-y-3">
                <div class="flex flex-row items-center gap-3">
                    <span class="w-7 h-7 rounded-full bg-brand-600 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">1</span>
                    <p class="text-sm font-semibold text-white">Seed tools into the registry</p>
                </div>
                <div class="ml-10">
                    <pre class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto text-surface-200">python asp_seed_tools.py</pre>
                    <p class="text-xs text-surface-400 mt-2">Indexes all 19 Arrissa tools with precomputed 384-dimension embeddings.</p>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex flex-row items-center gap-3">
                    <span class="w-7 h-7 rounded-full bg-brand-600 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">2</span>
                    <p class="text-sm font-semibold text-white">Start the server</p>
                </div>
                <div class="ml-10">
                    <pre class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto text-surface-200">python main.py</pre>
                    <p class="text-xs text-surface-400 mt-2">ASP runs alongside the existing API — no separate process needed.</p>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex flex-row items-center gap-3">
                    <span class="w-7 h-7 rounded-full bg-brand-600 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">3</span>
                    <p class="text-sm font-semibold text-white">Search for tools</p>
                </div>
                <div class="ml-10">
                    <div class="relative">
                        <button onclick="copyConfig('quickstart-search')" class="absolute top-3 right-3 flex flex-row items-center gap-1.5 text-xs text-surface-400 hover:text-brand-400 transition bg-surface-900/80 px-2.5 py-1.5 rounded-lg">
                            <i data-lucide="copy" class="w-3.5 h-3.5"></i><span>Copy</span>
                        </button>
                        <pre id="quickstart-search" class="bg-surface-800 border border-surface-700 rounded-xl p-4 text-sm font-mono overflow-x-auto text-surface-200">curl -X POST {{ site_url }}/asp/search \
  -H "X-API-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{"query": "show my trading performance"}'</pre>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex flex-row items-center gap-3">
                    <span class="w-7 h-7 rounded-full bg-brand-600 flex items-center justify-center text-xs font-bold text-white flex-shrink-0">4</span>
                    <p class="text-sm font-semibold text-white">Add custom tools (optional)</p>
                </div>
                <div class="ml-10">
                    <p class="text-sm text-surface-300">Use <span class="font-mono text-brand-400">POST /asp/tools</span> to register tools from any API — auto-embedded immediately.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- File Locations -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="folder-open" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">File Locations</h3>
        </div>
        <div class="p-6">
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                            <th class="text-left py-3 px-4 font-semibold">File</th>
                            <th class="text-left py-3 px-4 font-semibold">Purpose</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-surface-800">
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-brand-400">app/asp_routes.py</td>
                            <td class="py-3 px-4 text-sm text-surface-300">All ASP HTTP endpoints (search, register, reindex, status)</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-brand-400">app/asp_embeddings.py</td>
                            <td class="py-3 px-4 text-sm text-surface-300">Embedding engine — compute vectors, cosine similarity, provider logic</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-brand-400">app/models/asp_tool.py</td>
                            <td class="py-3 px-4 text-sm text-surface-300">Database model — tool definitions + embedding vectors</td>
                        </tr>
                        <tr>
                            <td class="py-3 px-4 font-mono text-sm text-brand-400">asp_seed_tools.py</td>
                            <td class="py-3 px-4 text-sm text-surface-300">Seeder script — indexes all Arrissa tools with embeddings</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<script>
function copyConfig(elementId) {
    const el = document.getElementById(elementId);
    const text = el.innerText || el.textContent;
    navigator.clipboard.writeText(text).then(() => {
        const btn = el.parentElement.querySelector('button span');
        if (btn) { btn.textContent = 'Copied!'; setTimeout(() => btn.textContent = 'Copy', 2000); }
    });
}
</script>

{% endblock %}
