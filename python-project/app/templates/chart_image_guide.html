{% extends "layout.html" %}
{% block title %}Chart Image API — {{ app_name }}{% endblock %}
{% block page_title %}Chart Image API{% endblock %}
{% block content %}

<div class="max-w-5xl mx-auto space-y-6">

    <!-- Introduction -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="book-open" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Overview</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                The {{ app_name }} Chart Image API renders a professional Japanese candlestick chart as a PNG image.
                It accepts the same parameters as the Market Data API but returns a rendered chart image instead of JSON data.
                Perfect for embedding in dashboards, reports, bots, or sharing on social media.
            </p>
            <div class="flex flex-row items-start gap-3 bg-surface-800/50 border border-surface-700 rounded-xl p-4">
                <i data-lucide="info" class="w-5 h-5 text-blue-400 flex-shrink-0 mt-0.5"></i>
                <p class="text-sm text-surface-300">
                    Find your API key on the <a href="/settings" class="text-brand-400 hover:text-brand-300 underline">Settings</a> page.
                    Your Arrissa Account IDs are shown on the <a href="/dashboard" class="text-brand-400 hover:text-brand-300 underline">Dashboard</a> and <a href="/brokers" class="text-brand-400 hover:text-brand-300 underline">Brokers</a> pages.
                </p>
            </div>
        </div>
    </div>

    <!-- Authentication -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="shield" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Authentication</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300 leading-relaxed">
                Every request must include your API key. You can pass it in two ways:
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-2">Header</p>
                    <code class="text-sm font-mono text-brand-400">X-API-Key: your_api_key</code>
                </div>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-2">Query Parameter</p>
                    <code class="text-sm font-mono text-brand-400">?api_key=your_api_key</code>
                </div>
            </div>
        </div>
    </div>

    <!-- GET /api/chart-image -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center justify-between">
            <div class="flex flex-row items-center gap-3">
                <span class="text-xs font-bold uppercase tracking-wider bg-green-900/40 text-green-400 border border-green-800 px-2.5 py-1 rounded-lg">GET</span>
                <h3 class="text-base font-semibold text-white font-mono">/api/chart-image</h3>
            </div>
        </div>
        <div class="p-6 space-y-6">

            <p class="text-sm text-surface-300 leading-relaxed">
                Returns a rendered Japanese candlestick chart as a PNG image. Same parameters as
                <a href="/market-data-api" class="text-brand-400 hover:text-brand-300 underline">/api/market-data</a>
                plus optional chart customisation parameters.
            </p>

            <!-- Parameters Table -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Parameters</p>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-xs uppercase tracking-widest text-surface-400 border-b border-surface-800">
                                <th class="text-left py-3 px-4 font-semibold">Name</th>
                                <th class="text-left py-3 px-4 font-semibold">In</th>
                                <th class="text-left py-3 px-4 font-semibold">Required</th>
                                <th class="text-left py-3 px-4 font-semibold">Description</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm text-surface-300">
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">api_key</td>
                                <td class="py-3 px-4">query / header</td>
                                <td class="py-3 px-4"><span class="text-red-400 text-xs font-semibold">required</span></td>
                                <td class="py-3 px-4">Your API key</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">arrissa_account_id</td>
                                <td class="py-3 px-4">query / header</td>
                                <td class="py-3 px-4"><span class="text-red-400 text-xs font-semibold">required</span></td>
                                <td class="py-3 px-4">Your Arrissa Account ID (e.g. <code class="text-brand-400">{{ example_account_id }}</code>)</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">symbol</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-red-400 text-xs font-semibold">required</span></td>
                                <td class="py-3 px-4">Trading symbol (e.g. <code class="text-brand-400">EURUSD</code>, <code class="text-brand-400">BTCUSD</code>)</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">timeframe</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-red-400 text-xs font-semibold">required</span></td>
                                <td class="py-3 px-4">Candle timeframe: <code class="text-brand-400">M1</code>, <code class="text-brand-400">M5</code>, <code class="text-brand-400">M15</code>, <code class="text-brand-400">M30</code>, <code class="text-brand-400">H1</code>, <code class="text-brand-400">H4</code>, <code class="text-brand-400">D1</code>, <code class="text-brand-400">W1</code>, <code class="text-brand-400">MN1</code></td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">count</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Number of bars (1–5000, default 100). Mutually exclusive with <code class="text-brand-400">period</code>.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">period</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Time period (e.g. <code class="text-brand-400">last-7-days</code>, <code class="text-brand-400">last-4-hours</code>). Mutually exclusive with <code class="text-brand-400">count</code>.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">pretend_date</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Simulate a historical "now" (<code class="text-brand-400">YYYY-MM-DD</code>)</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">pretend_time</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Time for pretend_date (<code class="text-brand-400">HH:MM</code>, default 00:00)</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">width</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Image width in pixels (400–3840, default <code class="text-brand-400">1200</code>)</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">height</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Image height in pixels (300–2160, default <code class="text-brand-400">700</code>)</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">theme</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Chart colour theme: <code class="text-brand-400">dark</code> (default, TradingView dark) or <code class="text-brand-400">light</code></td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">ma</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Moving average period(s), comma-separated (<code class="text-brand-400">ma=20</code> or <code class="text-brand-400">ma=20,50,200</code>). Draws SMA lines on the chart.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">quarters_s_n_r</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Set to <code class="text-brand-400">true</code> to draw 7 quarter-based support &amp; resistance levels as dashed horizontal lines on the chart (highest, lowest, 3 quarter divisions, and extensions above/below).</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">volume</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Set to <code class="text-brand-400">true</code> to show the volume sub-chart. Defaults to <code class="text-brand-400">false</code> (hidden).</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">order_blocks</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Set to <code class="text-brand-400">true</code> (requires <code class="text-brand-400">quarters_s_n_r=true</code>) to draw order-block rectangles on the chart. Highlights the last bearish candle before each support touch (Low, 25%) and the last bullish candle before each resistance touch (75%, High).</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">entry</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Trade entry timing. Use <code class="text-brand-400">market</code> for the current (last) close price, or a UTC datetime like <code class="text-brand-400">2026-01-10-10:20</code> to enter at that candle's close. Requires <code class="text-brand-400">direction</code> and either <code class="text-brand-400">sl</code>/<code class="text-brand-400">tp</code> (absolute prices) or <code class="text-brand-400">sl_points</code>/<code class="text-brand-400">tp_points</code>.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">direction</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Trade direction: <code class="text-brand-400">LONG</code> or <code class="text-brand-400">SHORT</code>. Required when <code class="text-brand-400">entry</code> is set.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">sl</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Stop-loss as an <strong>absolute price</strong> (e.g. <code class="text-brand-400">1.04200</code>). Cannot be combined with <code class="text-brand-400">sl_points</code>.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">tp</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Take-profit as an <strong>absolute price</strong> (e.g. <code class="text-brand-400">1.05000</code>). Cannot be combined with <code class="text-brand-400">tp_points</code>.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">sl_points</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Stop-loss distance in <strong>points</strong> from entry (e.g. <code class="text-brand-400">30</code>). Point size is auto-detected: 0.0001 for forex, 0.01 for JPY, 0.1 for gold, 1.0 for indices. Cannot be combined with <code class="text-brand-400">sl</code>.</td>
                            </tr>
                            <tr class="border-b border-surface-800/50">
                                <td class="py-3 px-4 font-mono text-brand-400">tp_points</td>
                                <td class="py-3 px-4">query</td>
                                <td class="py-3 px-4"><span class="text-surface-500 text-xs">optional</span></td>
                                <td class="py-3 px-4">Take-profit distance in <strong>points</strong> from entry (e.g. <code class="text-brand-400">60</code>). Same auto-detected point size. Cannot be combined with <code class="text-brand-400">tp</code>.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Response -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Response</p>
                <div class="bg-surface-800 border border-surface-700 rounded-xl p-4">
                    <p class="text-sm text-surface-300">
                        Returns a <code class="text-brand-400">image/png</code> response with the rendered candlestick chart.
                        The chart includes OHLC candles and a volume sub-chart, styled like TradingView.
                    </p>
                </div>
            </div>

            <!-- Examples -->
            <div>
                <p class="text-xs font-semibold text-surface-400 uppercase tracking-wider mb-3">Examples</p>
                <div class="space-y-4">

                    <!-- Example 1: Basic -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">Basic — last 100 candles (default)</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1</code></pre>
                    </div>

                    <!-- Example 2: Period -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">Period — last 7 days, daily candles</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=D1&period=last-7-days" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=D1&amp;period=last-7-days</code></pre>
                    </div>

                    <!-- Example 3: Custom size + light theme -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">Custom size + light theme</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=BTCUSD&timeframe=H4&count=50&width=1600&height=900&theme=light" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=BTCUSD&amp;timeframe=H4&amp;count=50&amp;width=1600&amp;height=900&amp;theme=light</code></pre>
                    </div>

                    <!-- Example 4: Pretend date -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">Historical — pretend it's Jan 1 2025</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&period=last-3-days&pretend_date=2025-01-01&pretend_time=12:00" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;period=last-3-days&amp;pretend_date=2025-01-01&amp;pretend_time=12:00</code></pre>
                    </div>

                    <!-- Example 5: Moving Averages -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">With 20 &amp; 50 moving averages</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&ma=20,50" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=100&amp;ma=<span class="text-amber-400">20,50</span></code></pre>
                    </div>

                    <!-- Example 6: Quarters Support & Resistance -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">With Quarters Support &amp; Resistance</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&quarters_s_n_r=true" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=100&amp;quarters_s_n_r=<span class="text-amber-400">true</span></code></pre>
                    </div>

                    <!-- Example 7: MA + Quarters S&R combined -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">MA(20,50) + Quarters S&amp;R combined</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&ma=20,50&quarters_s_n_r=true" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=100&amp;ma=<span class="text-amber-400">20,50</span>&amp;quarters_s_n_r=<span class="text-amber-400">true</span></code></pre>
                    </div>

                    <!-- Example 8: HTML embed -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center gap-2">
                            <i data-lucide="code" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                            <span class="text-xs font-semibold text-surface-400">Embed in HTML</span>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-blue-400">&lt;img src="{{ site_url }}/api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=100" alt="EURUSD H1 Chart" /&gt;</code></pre>
                    </div>

                    <!-- Example 9: With volume -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">With volume panel</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&volume=true" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=100&amp;volume=<span class="text-amber-400">true</span></code></pre>
                    </div>

                    <!-- Example 10: Order Blocks -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">With Quarters S&amp;R + Order Blocks</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&quarters_s_n_r=true&order_blocks=true" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=100&amp;quarters_s_n_r=<span class="text-amber-400">true</span>&amp;order_blocks=<span class="text-amber-400">true</span></code></pre>
                    </div>

                    <!-- Example 11: curl -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center gap-2">
                            <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                            <span class="text-xs font-semibold text-surface-400">Download with curl</span>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">curl -o chart.png "{{ site_url }}/api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=200"</code></pre>
                    </div>

                    <!-- Example 12: Long position at market with points -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">Long position at market (SL 30pts, TP 60pts)</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=100&entry=market&direction=LONG&sl_points=30&tp_points=60" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=100&amp;entry=<span class="text-amber-400">market</span>&amp;direction=<span class="text-amber-400">LONG</span>&amp;sl_points=<span class="text-amber-400">30</span>&amp;tp_points=<span class="text-amber-400">60</span></code></pre>
                    </div>

                    <!-- Example 13: Short position with absolute prices -->
                    <div class="bg-surface-800 border border-surface-700 rounded-xl overflow-hidden">
                        <div class="px-4 py-2.5 border-b border-surface-700 flex flex-row items-center justify-between">
                            <div class="flex flex-row items-center gap-2">
                                <i data-lucide="terminal" class="w-4 h-4 text-surface-400 flex-shrink-0"></i>
                                <span class="text-xs font-semibold text-surface-400">Short position with absolute SL/TP prices</span>
                            </div>
                            <a href="/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=EURUSD&timeframe=H1&count=200&entry=2026-02-10-14:00&direction=SHORT&sl=1.05000&tp=1.03000" target="_blank" class="flex flex-row items-center gap-1.5 text-xs text-brand-400 hover:text-brand-300 transition">
                                <i data-lucide="play" class="w-3.5 h-3.5"></i>
                                <span>Try it</span>
                            </a>
                        </div>
                        <pre class="p-4 overflow-x-auto"><code class="text-sm text-green-400">GET /api/chart-image?api_key={{ api_key }}&amp;arrissa_account_id={{ example_account_id }}&amp;symbol=EURUSD&amp;timeframe=H1&amp;count=200&amp;entry=<span class="text-amber-400">2026-02-10-14:00</span>&amp;direction=<span class="text-amber-400">SHORT</span>&amp;sl=<span class="text-amber-400">1.05000</span>&amp;tp=<span class="text-amber-400">1.03000</span></code></pre>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <!-- Live Preview -->
    <div class="bg-surface-900 border border-surface-800 rounded-2xl">
        <div class="px-6 py-5 border-b border-surface-800 flex flex-row items-center gap-3">
            <i data-lucide="image" class="w-5 h-5 text-brand-400 flex-shrink-0"></i>
            <h3 class="text-base font-semibold text-white">Live Preview</h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-sm text-surface-300">
                Enter parameters below and click <strong class="text-white">Generate Chart</strong> to see a live preview.
            </p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-xs font-semibold text-surface-400 uppercase tracking-wider mb-1.5">Symbol</label>
                    <input id="prev-symbol" type="text" value="EURUSD" class="w-full bg-surface-800 border border-surface-700 text-white text-sm rounded-lg px-3 py-2 focus:border-brand-500 focus:outline-none" />
                </div>
                <div>
                    <label class="block text-xs font-semibold text-surface-400 uppercase tracking-wider mb-1.5">Timeframe</label>
                    <select id="prev-timeframe" class="w-full bg-surface-800 border border-surface-700 text-white text-sm rounded-lg px-3 py-2 focus:border-brand-500 focus:outline-none">
                        <option value="M1">M1</option>
                        <option value="M5">M5</option>
                        <option value="M15">M15</option>
                        <option value="M30">M30</option>
                        <option value="H1" selected>H1</option>
                        <option value="H4">H4</option>
                        <option value="D1">D1</option>
                        <option value="W1">W1</option>
                        <option value="MN1">MN1</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs font-semibold text-surface-400 uppercase tracking-wider mb-1.5">Count</label>
                    <input id="prev-count" type="number" value="100" min="1" max="5000" class="w-full bg-surface-800 border border-surface-700 text-white text-sm rounded-lg px-3 py-2 focus:border-brand-500 focus:outline-none" />
                </div>
                <div>
                    <label class="block text-xs font-semibold text-surface-400 uppercase tracking-wider mb-1.5">Theme</label>
                    <select id="prev-theme" class="w-full bg-surface-800 border border-surface-700 text-white text-sm rounded-lg px-3 py-2 focus:border-brand-500 focus:outline-none">
                        <option value="dark" selected>Dark</option>
                        <option value="light">Light</option>
                    </select>
                </div>
            </div>
            <button onclick="generateChart()" class="flex flex-row items-center gap-2 bg-brand-600 hover:bg-brand-500 text-white text-sm font-semibold px-5 py-2.5 rounded-lg transition-all duration-200">
                <i data-lucide="image" class="w-4 h-4 flex-shrink-0"></i>
                <span>Generate Chart</span>
            </button>

            <!-- Preview container -->
            <div id="chart-preview" class="hidden mt-4">
                <div id="chart-loading" class="hidden flex items-center justify-center py-16">
                    <div class="flex flex-row items-center gap-3 text-surface-400">
                        <svg class="animate-spin h-5 w-5" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
                        <span class="text-sm">Rendering chart...</span>
                    </div>
                </div>
                <img id="chart-img" class="rounded-xl border border-surface-700 w-full hidden" alt="Chart Preview" />
                <div id="chart-error" class="hidden bg-red-900/30 border border-red-800 text-red-300 px-5 py-4 rounded-xl text-sm"></div>
            </div>
        </div>
    </div>

</div>

<script>
function generateChart() {
    const symbol = document.getElementById('prev-symbol').value.trim().toUpperCase();
    const timeframe = document.getElementById('prev-timeframe').value;
    const count = document.getElementById('prev-count').value;
    const theme = document.getElementById('prev-theme').value;

    if (!symbol) return;

    const preview = document.getElementById('chart-preview');
    const loading = document.getElementById('chart-loading');
    const img = document.getElementById('chart-img');
    const error = document.getElementById('chart-error');

    preview.classList.remove('hidden');
    loading.classList.remove('hidden');
    img.classList.add('hidden');
    error.classList.add('hidden');

    const url = `/api/chart-image?api_key={{ api_key }}&arrissa_account_id={{ example_account_id }}&symbol=${encodeURIComponent(symbol)}&timeframe=${timeframe}&count=${count}&theme=${theme}&width=1200&height=700`;

    // Use fetch to detect errors vs success
    fetch(url)
        .then(resp => {
            if (!resp.ok) {
                return resp.json().then(data => { throw new Error(data.error || 'Unknown error'); });
            }
            return resp.blob();
        })
        .then(blob => {
            loading.classList.add('hidden');
            const objectUrl = URL.createObjectURL(blob);
            img.src = objectUrl;
            img.classList.remove('hidden');
        })
        .catch(err => {
            loading.classList.add('hidden');
            error.textContent = err.message;
            error.classList.remove('hidden');
        });
}
</script>

{% endblock %}
